\documentclass{article}

\usepackage{xeCJK}

\begin{document}

\title{编译原理可视化}

\section{动画设计的基本要求}
尽管在当今的社会中，可视化技术发展很迅猛，参与可视化工作的人们把动画做
得越来越绚丽多彩，然而可视化重要的一个部分，不是将动画写得有多么绚丽，
而是，动画能够让看到动画的人，真正感受到动画背后的深意，比如数据，比如
算法。在这个课题中，动画的目的是为了让教师能够更轻松教懂学生如何理解编
译原理过程中的各个算法，而学生也应该能够自己从动画中，相较于枯燥的文字，
静态的幻灯片，这些传统的内容中解脱出来，投入到一个更新鲜有趣的学习环境
中，利用这些有趣的动画，更容易更深刻理解算法，甚至可以透过这些动画，来
了解深一层次的算法含义。除了这个已经变得流行起来的可视化基本理念，我们
在设计中，还融入的，应该让学生能够自己去控制动画的过程，从而从动画的角
度来理解算法的运作。
\section{设计的几类动画}
动画中有纯粹展示类型的动画，比如其中的一个左递归消除的动画，它实现了按
步骤完成的整体动画，也提供了可以供用户单步进行的动画，用户也能够回退已
经执行过的动画，这些都在系统中实现了，但是，用户不能再动画运行过程中干
预动画的内容，也就是，它是一个纯粹的动画，甚至我们实现中就是将这个动画
对应的算法执行完毕之后，才开始进行动画，也就是说，动画的步骤是被实现记
录好了。
然而，系统中，并不只有这种类型的动画，另外也设计了一种动画，这种动画实
际上能够让用户参与进来，也就是说，用户可以改变某些变量，从而得到一个完
全不一样的动画形态，换句话说，用户不止可以在一开始的时候指定状态，甚至
可以在动画进行的过程中指定状态，从而让动画往不一样的方向发展。
根据动画的形态来区分系统中存在的动画，有这几种，分别是，形象化表达的动
画，比如消除左递归中，分别出现原本的产生式，接着，产生式的一部分被移除
画面，另一部分保留在画面中，并且缩进成一个紧凑的形态，这之后，，这个紧
凑的形态，再次伸展开来，插入新的字符，从而得到了产生式A，而此后，这个
产生式A再次消失。这个动画结束以后，再浮现出新的一组产生式，这组产生式
的字符就由刚才最先被移除的那部分字符组成，然后，再附上新的字符，使得产
生式消除左递归的过程得到充分地展现。
\section{如何设计这些动画}
要理解这些动画是如何设计出来的，那么需要先理解状态机是如何工作的，我们
在设计动画的时候，是把动画的表现抽离出来的，也就是，并不是将动画放入我
们所编写的算法中，而是作为独立的模块存在的，它算法本身的实现，几乎没有
什么联系，除了算法本身的特点将影响我们所采用的动画这一点以外。算法本身
运行的时候，自身是一个状态机，也就是，它从一个状态进入到另一个状态，或
者也可以回去，等等，并不与外界产生交互。然而，我们在外界是可以控制算法
是如何运行的。而之后，我们提取状态机，也就是算法，运行过程中，是如何改
变状态的，把这些状态的改变都记录下来，而最终就是根据这些状态的改变来生
成动画的。对于那种动画进行过程中，却可以改变算法的状态的，其实就是利用
了，状态机本身不对外界产生影响，但是，外界却能够对状态机产生影响这个道
理。而且，因为状态机记录的内容并不会丢失掉，不会因为算法重新执行到哪一
个而导致之前的步骤消失，所有的步骤都被完整记录下来。当外界去改变状态机
的一些状态走向的时候，也只是改变状态机未来的状态，也就是说，状态机还没
有走过的状态，所以不用担心状态丢失而不能有效表达动画。从这个层面上看，
这类型的动画，就不是离线的，而是实时的，围绕着用户的交互而进行的一种动
画。

除了状态机这样的观点来做动画以外，我其实更喜欢把算法看做是一系列的动作
制定器，在算法运行的时候，在程序的一些关键点中，加入算法记录函数，也就
是算法记录点，在这些算法记录点中，我可以提取动画所需要的数据，之后通过
获取这些算法记录点，我们可以将动画展示出来。当然，这样子实现的动画，是
没有额外的交互功能的，所谓额外交互功能就是除了单点执行中的前进后退，完
整执行一段动画这俩个主要的动能以外，没有别的交互功能。当然，如果暴露出
更多的信息，通过这些算法记录点，那么还可以让用户观测到这个算法执行到当
前时间段的时候，所有当前的变量信息、环境信息等等。这种方式，实际上就是
我们初次版本所要实现的方式，而更理想的状态机的方式，其实也是在这种方式
上面进行改造的结果。然而，在实现时，状态机的方式还有更多的问题需要解决，
所以在后续的开发中，我们要逐一解决这些问题。

\section{动画交互的要点}
\paragraph{动画交互}
动画交互需要注意分出来，哪一些是必要的部分，而哪一些是不必要的信息。还
有哪一些是要一直强调的部分，哪一些是在用户需要的时候才展现给用户看的部
分。具体来说的话，就是指的，在动画演示的过程中，有一些部分，要着重强调
出来，比如说，算法执行的主要步骤，算法在某一个时刻，实际上是对什么进行
操作，做了哪些操作，如果有办法，甚至还要体现为什么要做这些操作，让学生
可以通过看到这些动画，就能明白这些操作的含义，可以自己去完成这些操作。
除此之外，还有一些部分是在算法演示中不一定被强调的，比如当前执行的循环
次数，当前某个变量的值，这些东西的存在，可能会干扰学生进行感性的思考，
但是这些东西也必须存在，如果因为为了美观和可读性而直接牺牲了这些数据，
那么得到的内容是不完整的。当学生想要深入思考这些变量的变化的时候，就需
要这些更细节的内容，只是依靠图上的变化，是不足以让学生了解这些细节的变
化。

\section{实际的疏漏}
\paragraph{代码复用}
在代码编写的时候，实际上我本应该尽可能利用已有的工具来完成一些功能，而
事实上我确实已经借助了一些开源工具来完成整个不属于我课题本身的内容，比
如使用了D3来完成动画，使用了angular来组织整体的代码。但是我却没有一开
始就从其他的编译器解析相关的项目入手，比如网络上已经存在的jison这样的
开源项目，这是一个很重要的疏漏，如果早一些利用jison已经实现的算法，配
合我们做动画的思路，我们应该能够完成更多的动画，也可以把时间留在设计更
合理的动画上面，而不是写更多的算法。为什么这么说呢，算法本身就是很多人
都已经实现了，课题的重心并不是去重新实现这些算法，而是将这些算法可视化
展现出来，然而最终我们却浪费了大量的时间和精力去学习这些算法，重新实现
这些算法。
\paragraph{程序结构}
在程序设计的时候，因为想尝试更多的组织方式，所以中间有段时间去使用了更
新的一些开源类库，然而效果并不好。而在后来的实践中发现，在现有的基础上
去改变代码的结构，而不是通过替换底层我们依赖的框架，有时候的表现更好。
例如说，我们最后将代码使用 typescript 整理起来，依靠类与模块来把代码一
个一个独立出来，得到一个相对清晰的代码结构。当然，在界面展示那个层次上，
代码的可读性还不是那么好，但是我们相信，这些内容可以在后续不断改进中，
把他们处理得当。
\paragraph{他人的研究}
我们在进行这项课题的研究的时候，忽略了其实有导师教导过我们的事情，就是
着手开始一个课题的时候，要去先找找历史上，其他人对这个课题或者说是类似
课题的研究。这一步被我们省略了，或者是完全没有在一开始的时候意识到，这
是一个非常重要的疏漏。最后在整理论文的时候，其实我们已经看到了很多其他
科研人员研究的内容，他们对可视化的分析很多方面都比我们透彻，而如果一开
始，我们就已经吸收了他们的研究，那么就可以做到在巨人的肩上，看得更高更
远，也就能获得更好的成果。尽管如此，我们也不会就这样结束掉这个课题，而
会继续在这个课题上充当一个合格的维护者的角色，为后续参与这个课题的同学
们提供我们的思路以及我们在之前所遇到的各种问题，还有我们对待这个课题的
想法。我们相信，这一切都是非常有价值的，就如同他人的研究对我们自己的研
究也同样有价值一般。
\paragraph{课题的局限性}
课题主要针对的是编译原理过程，主要是前端过程的可视化，而这一点，其实是
可以延伸到实际设计算法中使用的。课题实际实现的内容，可以用在实际词法、
语法分析器的生成，而不仅仅局限于，将其演示为动画就作为课题的结束。实际
中，可以将这一教学工具，更充分利用起来，可以实现诸如语法调试等等功能，
来帮助学生自己设计文法的时候进行可视化调试，更深刻理解编译原理前端的过
程，以及能够作为一些爱好者、文法研究人员的可视化工具。当然，这对于我们
开发者的要求非常高，需要我们本身对编译原理的理解够深刻，同时也是对交互
界面的理解足够深刻，才能完成。这一点内容，其实是作为一种遗憾而写在这里
的，我们希望，以后能有更多的人参与这方面的努力，从而让编译界不再令新人
恐慌，让更多的人，看到编译原理其实不是那么困难，甚至是十分有趣的一件事
情。
\paragraph{内容的欠缺}
在这个课题中，其实最终的目的是为了让学生们学习编译原理的几个过程，那么
当当只是动画其实是不够的，也应该加入更多的内容才能真正让学生学起来。所
以，方便学生输入文法，进行更友好的文法错误提示（是的，不要惊讶，我们是
有文法错误提示，就是不够友好）。同时，如果能在系统中设计一些交互性的游
戏，配合着文法设计进行起来，配合着对算法的理解，那么，应该可以做出一个
非常有实质作用的系统。

\end{document}